# Правила разработки кода

## Общие принципы

- **KISS** — простота превыше всего. Избегай избыточных абстракций и сложных паттернов.
- **Минимализм** — только необходимый функционал для MVP. Без "на будущее".
- **Читаемость** — код должен быть понятен без комментариев. Имена переменных и функций на русском или английском, но осмысленные.

## Язык и библиотеки

- **Python 3.10+** — минимальная версия для совместимости.
- **aiogram 3.x** или **python-telegram-bot** — выбор библиотеки для Telegram API.
- **SQLite** — единственная БД. Используй встроенный `sqlite3` или `aiosqlite` для асинхронности.
- Минимум зависимостей. Каждая библиотека должна быть обоснована.

## Структура проекта

```
bot/
  ├── main.py              # Точка входа
  ├── config.py            # Конфигурация (токен, часовой пояс)
  ├── database.py          # Работа с БД
  ├── handlers/            # Обработчики команд и сообщений
  ├── keyboards.py         # Клавиатуры и кнопки
  ├── utils/               # Утилиты (валидация дат, форматирование)
  └── scheduler.py         # Расписание рассылок
```

## Безопасность и валидация

- **Проверка user_id** — на каждом обработчике перед выполнением логики.
- **Валидация дат** — строгий формат `dd.MM.YYYY` или `dd.MM`. Проверка корректности и последовательности.
- **Обработка ошибок** — все исключения должны логироваться. Пользователю — понятное сообщение на русском.

## Работа с БД

- Используй параметризованные запросы (защита от SQL-инъекций).
- Все операции с БД — через единый модуль `database.py`.
- При ошибках БД — логирование и откат транзакций где необходимо.

## Часовой пояс и время

- Все операции с датой/временем — через `pytz` с часовым поясом `Asia/Yekaterinburg`.
- Храни даты в БД в формате `DATE` или `TEXT` (ISO формат).
- При перезапуске бота — проверка и восстановление расписания рассылок (избегать дублей).

## Интерфейс

- Все сообщения бота — **на русском языке**.
- Кнопки и меню — понятные, без сокращений где возможно.
- Ошибки пользователю — дружелюбные, с подсказками.

## Код для упаковки

- Конфигурация через переменные окружения или `.env` файл.
- Логирование в файл и консоль.
- Graceful shutdown — корректное завершение при остановке.
- Отсутствие hardcoded путей — относительные пути или через конфиг.

## Тестирование

- Критичные функции (валидация дат, проверка прав) — покрыть тестами.
- Тесты в директории `tests/` с префиксом `test_`.

## Документация кода

- Docstrings для публичных функций и классов (на русском или английском).
- Типы параметров и возвращаемых значений — через type hints.

